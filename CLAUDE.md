# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

**Язык общения в этом проекте — русский.**

## Обзор проекта

**iPhone Terminal Ultra Setup** — Bash-инсталлятор, который настраивает Linux-сервер для продуктивной работы через iPhone SSH-клиент (Termius). Разворачивает конфиг tmux, алиасы шелла и плагины сохранения сессий, оптимизированные для мобильного терминала + Claude Code.

**Это не компилируемый проект** — shell-скрипты без системы сборки, тестов и линтера.

## Запуск

```bash
bash setup.sh
```

Инсталлятор интерактивный (спрашивает на каждом шаге). Запускать **вне tmux**. Автоматически определяет ОС и пакетный менеджер (apt/yum/dnf/apk/brew).

## Структура репозитория

- `setup.sh` — Основной интерактивный инсталлятор (~454 строк). Определение системы, установка пакетов, деплой конфигов, установка плагинов.
- `iphone-terminal-setup.md` — Пошаговая инструкция для ручной установки + шпаргалка по горячим клавишам (альтернатива setup.sh).
- `.claude/settings.local.json` — Конфиг разрешений Claude Code.

## Архитектура setup.sh

Скрипт работает как линейный пайплайн:

1. **Анализ системы** — определяет ОС, пакетный менеджер, шелл, установленные инструменты (tmux, git, claude)
2. **Настройки пользователя** — запрашивает путь к проектам (по умолчанию `/opt`) и выбор компонентов
3. **Бэкап** — создаёт резервную копию `~/.bashrc` и `~/.tmux.conf` в `~/.terminal-setup-backup-<timestamp>/`
4. **Установка пакетов** — ставит tmux/git через определённый пакетный менеджер (абстракция `install_pkg()`)
5. **Деплой конфигов** — дописывает алиасы/функции/меню логина в RC-файл шелла, создаёт `~/.tmux.conf`
6. **Установка плагинов** — клонирует tmux-resurrect и tmux-continuum, настраивает крон для очистки
7. **Финализация** — применяет конфиги и выводит шпаргалку

Ключевые решения:
- Tmux prefix — `Ctrl+A` (не дефолтный `Ctrl+B`) для удобства на iPhone
- Переключение окон стрелками (prefix + Up/Down) вместо цифр
- Переключение панелей через Alt+стрелки (без prefix)
- Проекты живут в `/opt` по умолчанию с табом через функции `p` и `np`
- Автосохранение сессий через tmux-continuum каждые 10 минут; крон чистит сохранения старше 60 минут

## Разворачиваемые алиасы

| Алиас | Раскрывается в |
|-------|----------------|
| `c` | `claude` |
| `cr` | `claude --resume` |
| `cc` | `claude --continue` |
| `q` | `claude -p` |
| `tl` | `tmux ls` |
| `tk` | `tmux kill-session -t` |
| `p <имя>` | `cd /opt/<имя> && ls` |
| `np <имя>` | `tmux new -s <имя> -c /opt/<имя>` |

## Важное при работе с кодом

- Весь пользовательский текст в setup.sh на **русском** — сохраняй это при изменениях
- Скрипт использует `set -e` — любая ошибка команды прерывает выполнение
- Деплой конфигов: `cat >>` (дописывание) для shell RC и `cat >` (перезапись) для tmux.conf
- `install_pkg()` — единственная абстракция для кроссплатформенной установки пакетов
- Хелпер-функции (`info`, `warn`, `error`, `header`) — цветной вывод в терминал
